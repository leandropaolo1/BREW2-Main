{% extends "brewwerblog/base.html" %}
{% block content %}
{% load static %}
<div class="row">

	<div class="col px-0 my-3">
		<div class="container">
			<div class="">
				<div class="row  ">

					<div class="col d-flex justify-content-center">
						<div class="row">
							<a href="{% url 'brewwer-home' %}" class="btn button-border-orange_2 fw500 text-black my-4" role="button" aria-disabled="true">
		  
							  <div class="d-flex align-content-center">
								<div class="d-flex align-items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="lime" class="bi bi-x-diamond" viewBox="0 0 16 16">
                    <path d="M7.987 16a1.526 1.526 0 0 1-1.07-.448L.45 9.082a1.531 1.531 0 0 1 0-2.165L6.917.45a1.531 1.531 0 0 1 2.166 0l6.469 6.468A1.526 1.526 0 0 1 16 8.013a1.526 1.526 0 0 1-.448 1.07l-6.47 6.469A1.526 1.526 0 0 1 7.988 16zM7.639 1.17 4.766 4.044 8 7.278l3.234-3.234L8.361 1.17a.51.51 0 0 0-.722 0zM8.722 8l3.234 3.234 2.873-2.873c.2-.2.2-.523 0-.722l-2.873-2.873L8.722 8zM8 8.722l-3.234 3.234 2.873 2.873c.2.2.523.2.722 0l2.873-2.873L8 8.722zM7.278 8 4.044 4.766 1.17 7.639a.511.511 0 0 0 0 .722l2.874 2.873L7.278 8z"/>
                  </svg>
								</div>
			
								<span class="h3 mb-0 text-white mx-3" style="font-weight:200">Explore</span>
							  </div>
							  </a>
						  </div>

					</div>

				</div>
			</div>

		</div>
	</div>

</div>
<div class="col  infinite-container">

  {% for post in listofnum %}
  <div class=" infinite-item BlueOutlineCss2 pt-2 ">
    <div class="row">
      <div class="col">

        <!-------Media Body------Media Body------Media Body-->
        <!-------Media Body------Media Body------Media Body-->


        <div>
          <div class="container">
            <div class="row">
              <div class="col-2 d-flex justify-content-center align-items-center">
                <a href="{% url 'show_profile_page' post.author.id %}">
                  <img class="rounded-circle article-img m-0 " src="{{ post.author.profile.image.url}}">
                </a>
              </div>
              <div class="col">
                <div class="">
                  <div class="login d-flex align-content-start ">
                    <div class="col-12 col-md-12 col-lg-11 col-xl-11">
                      <div class="row">
                        <a class="px-0" href="{% url 'show_profile_page' post.author.id %}">@{{ post.author }}</a>
                        <div class="d-flex align-items-end px-0">
                          <small class="text-muted mx-0 px-0">{{ post.data_posted }}</small>

                        </div>
                      </div>

                      <div class="row ">
                        <a href="{% url 'post-detail' post.id %}" class="link-secondary text-white p-0 ">
                          <span class="h5  mt-3">{{ post.title }}</span>
                        </a>
                        <p class="article-content px-0  mb-0"></br>{{ post.snippet}} </p>


                      </div>



                    </div>
                  </div>
                </div>


              </div>
            </div>

          </div>
        </div>

        <div>
          <div class="media-body">
            <div class="d-flex justify-content-center my-4">
              {% if post.header_image%}
              <a href="{% url 'post-detail' post.id %}">
                <img src="{{ post.header_image.url }}" class="img-fluid">

              </a>
              {%endif%}
            </div>
          </div>
          <div class="row mt-4">

            <div class="col">
              <div class=" d-flex justify-content-center">
                <button type="button" data-answer="{{post.id}}" class=" btn btn-button btn-sm cmt_btn "><svg
                    xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                    class="bi bi-chat-dots" viewBox="0 0 16 16">
                    <path
                      d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    <path
                      d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z" />
                  </svg></button>
                <p class="text-muted mx-2 my-0">{{post.comments.count}}</p>
              </div>

            </div>

            <div class=" col">
              <div class=" d-flex justify-content-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="orange"
                  class=" bi bi-arrow-down-circle downvote-click" data-answer="{{post.id}}" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z" />
                </svg>
                <p class="downvote-count-{{post.id}} text-muted mx-2">{{post.downvote_set.count}}</p>
              </div>

            </div>
            <div class="col">
              <div class=" d-flex justify-content-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="lightgreen"
                  class="upvote-click bi bi-arrow-up-circle" data-answer="{{post.id}}" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z" />
                </svg>
                <p class="upvote-count-{{post.id}} text-muted mx-2">{{post.upvote_set.count}}</p>
              </div>
            </div>



          </div>
        </div>


        <div class="mt-3 comment-wrapper-{{post.id}} comment-box-{{post.id}}">
          <div class="row">

            <div class="col">
              <div class="container">
                <textarea class="form-control comment-text-{{post.id}} placeholder="
                  placeholder="Add a comment"></textarea>

              </div>
            </div>




          </div>
          {%if post.comments.all %}
          {% for c in post.comments.all %}
          <div>

            <ul>
              <span>
                <strong class="text-info">{{ c.author }} </strong>
                <small class="text-muted">{{ c.date_posted }}</small>

              </span>
              <p>
                {{ c.comment}}
              </p>
            </ul>
          </div>
          {% endfor %}
          {% else %}
          <div class="container mb-3">
            <strong class="text-secondary">No comments yet by others...</strong>

          </div>
          {% endif %}
        </div>
      </div>
    </div>




  </div>

  {% endfor %}
</div>
<div class="row">
  <div class="col">
    <a href="{%url 'brewwer-explore' %}">
      <button type="button" class="btn btn-outline-primary btn-lg btn-block">More Brews</button>

    </a>

  </div>
</div>
{%if page_obj.has_next %}
<a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}"></a>
<!--<a class= "btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">Last</a>-->
{%endif%}

<script src="{% static 'brewwerblog/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'brewwerblog/infinite.min.js' %}"></script>


<script src="{% static 'brewwerblog/jquery-3.6.0.min.js' %}"></script>
<script>
  $(document).ready(function () {
    $(".save-comment").on('click', function (event) {
      var _answerid = $(this).data('answer');
      var _comment = $(".comment-text-" + _answerid).val();

      $.ajax({
        url: "/save-comment",
        type: "POST",
        data: {
          answerid: _answerid,
          comment: _comment,
          csrfmiddlewaretoken: "{{csrf_token}}"
        },
        dataType: 'json',
        beforeSend: function () {
          $(".save-comment").addClass('disabled')
        },
        success: function (res) {
          var _prevcomment = $(".comment-count-" + _answerid).text();

          if (res.bool == true && !(_comment === "")) {
            $(".comment-text-" + _answerid).val('');
            var _html = '<div>\
                          <ul>\
                            <span>\
                            <strong class="text-info">{{ request.user }} </strong>\
                            <smal class="text-muted">{% now "jS F Y H:i" %} </small>\
                            </span>\
                            <p>' + _comment + '</p>\
                            </ul>\
                        </div>';
            $(".comment-wrapper-" + _answerid).prepend(_html);
            $(".comment-count-" + _answerid).text(parseInt(_prevcomment) + 1);

          } else {}
          $(".save-comment").removeClass('disabled')
          $(".no-comment-" + _answerid).remove();

        }
      });
      console.log(_comment, _answerid);
    });
    let display = false
    $(".cmt_btn").click(function () {
      var _buttonid = $(this).data('answer');
      if (display === false) {
        $(".comment-box-" + _buttonid).show("fast");
        display = true
      } else {
        $(".comment-box-" + _buttonid).hide("fast");
        display = false
      }
    });
    $(".upvote-click").on('click', function () {
      var answerid = $(this).data('answer');
      console.log(answerid);
      $.ajax({
        url: "/save-upvote",
        type: "POST",
        data: {
          answerid: answerid,
          csrfmiddlewaretoken: "{{csrf_token}}"
        },
        dataType: 'json',
        success: function (res) {
          console.log(res)
          var _prevupvote = $(".upvote-count-" + answerid).text();
          if (res.bool == true) {
            $(".upvote-count-" + answerid).text(parseInt(_prevupvote) + 1);
          }
        }
      });
    });
    $(".downvote-click").on('click', function () {
      var answerid = $(this).data('answer');
      // Ajax
      $.ajax({
        url: "/save-downvote",
        type: "post",
        data: {
          answerid: answerid,
          csrfmiddlewaretoken: "{{csrf_token}}"
        },
        dataType: 'json',
        success: function (res) {
          var _prevupvote = $(".downvote-count-" + answerid).text();
          if (res.bool == true) {
            $(".downvote-count-" + answerid).text(parseInt(_prevupvote) + 1);
          }
        }
      });
    });
    var infinite = new Waypoint.Infinite({
      element: $('.infinite-container')[0],

      offset: 'bottom-in-view',
      onBeforePageLoad: function () {

      },
      onAfterPageLoad: function () {

      }

    })
  });
</script>

{% endblock content %}
